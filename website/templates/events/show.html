{% extends 'base.html' %} {% from 'bootstrap5/form.html' import render_form %}
{% block content %}

<div class="container mt-5">
  <!-- Centered Event Image -->
  <div class="text-center mb-4">
    <img
      src="{{ event.image }}"
      alt="{{ event.title }}"
      class="img-fluid rounded shadow-sm"
      style="max-width: 600px"
    />
  </div>

  <div class="row mt-5 mb-3">
    <!-- Left column: Event Info -->
    <div class="col">
      <h1 class="mb-0">{{ event.title }}</h1>

      <hr />

      <h2>Details</h2>
      <p><strong>Date:</strong> {{ event.date }}</p>
      <p><strong>Status:</strong> {{ event.status }}</p>
      <p>
        <strong>Created by:</strong> {{ event.creator.first_name }} {{
        event.creator.last_name }}
      </p>

      <hr />

      <h2>Description</h2>
      <p>{{ event.description }}</p>

      <hr />

      <!-- Comments -->
      <div class="row">
        <div class="col-md-12">
          <h2>Comments</h2>
        </div>
      </div>

      <div class="row">
        {{ render_form(cform,"/events/{0}/comment".format(event.id)) }} {% for
        comment in event.comments %}
        <div class="col-md-12">
          <b
            >{{ comment.user }}
            <span class="ml-2 text-muted">{{ comment.created_at.strftime("%b %d, %Y %I:%M %p") }}</span>
          </b>
          <p>{{ comment.text }}</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Right column: Ticket Info -->
    <div class="col-lg-4 col-md-5">
      <div class="sticky-top" style="top: 5rem">
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <h4 class="card-title">Tickets</h4>
            <!-- Button trigger modal -->
            {% if event.status == "Open" %}
            <p><strong>Price per ticket:</strong> ${{ event.price }}</p>
            <p><strong>Available:</strong> {{ event.quantity }} tickets</p>
            <button
              type="button"
              class="btn btn-primary w-100"
              data-bs-toggle="modal"
              data-bs-target="#bookModal"
            >
              Purchase Tickets
            </button>
            {% else %}
            <p class="text-danger">
              <strong>Event is not open for booking.</strong>
            </p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Booking Modal -->
      <div
        class="modal fade"
        id="bookModal"
        tabindex="-1"
        aria-labelledby="bookModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="bookModalLabel">Confirm Booking</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <!-- Purchase Form -->
              {{ render_form(oform, url_for('event.purchase', id=event.id)) }}
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <!-- <button type="button" class="btn btn-primary">Confirm</button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
